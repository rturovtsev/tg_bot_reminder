# Telegram Bot Reminder

Простой Telegram бот для создания напоминаний с поддержкой естественного языка и повторяющихся событий. Бот парсит временные выражения на русском и английском языках и сохраняет напоминания в SQLite базе данных.

## Возможности

- Создание разовых напоминаний с использованием естественного языка
- Поддержка повторяющихся напоминаний (ежедневно, еженедельно, ежемесячно, ежегодно)
- Парсинг временных выражений на русском и английском языках
- Просмотр списка активных напоминаний
- Автоматическое удаление разовых напоминаний после срабатывания
- Автоматическое обновление времени для повторяющихся напоминаний

## Установка и настройка

### Требования

- Go 1.19+
- SQLite3
- Telegram Bot Token (получить у @BotFather)

### Установка

1. Клонируйте репозиторий:
```bash
git clone <repository-url>
cd reminder
```

2. Установите зависимости:
```bash
go mod tidy
```

3. Создайте Telegram бота:
   - Напишите @BotFather в Telegram
   - Выполните команду `/newbot`
   - Следуйте инструкциям и получите токен

4. Соберите приложение:
```bash
go build -o reminder ./cmd/bot
```

## Запуск

### Режим разработки
```bash
ENV=dev BOT_TOKEN=your_bot_token_here go run ./cmd/bot
```

### Продакшн режим
```bash
BOT_TOKEN=your_bot_token_here ./reminder
```

### Docker
```bash
docker build -t reminder .
docker run -e BOT_TOKEN=your_bot_token_here reminder
```

## Использование

### Команды бота

- `/start` - Запустить бота и показать справку
- `/list` - Показать список всех активных напоминаний

### Создание разовых напоминаний

Просто отправьте сообщение с указанием времени и текста напоминания:

```
сегодня в 15:30 встреча с клиентом
```

```
завтра в 9:00 позвонить врачу
```

```
в пятницу в 18:00 ужин с друзьями
```

```
в следующую среду в 12:25 доклад на конференции
```

### Создание повторяющихся напоминаний

Для создания повторяющихся напоминаний используйте ключевые слова:

#### Ежедневные напоминания
```
ежедневно в 9:00 зарядка
```

```
каждый день в 22:00 принять витамины
```

#### Еженедельные напоминания
```
еженедельно в понедельник в 10:00 планерка
```

```
каждую неделю в пятницу в 17:00 отчет
```

#### Ежемесячные напоминания
```
ежемесячно 1 числа в 12:00 оплата аренды
```

```
каждый месяц 15 числа в 10:00 подача отчетности
```

#### Ежегодные напоминания
```
ежегодно 31 декабря в 23:00 подготовка к Новому году
```
## Примеры использования

### Базовые напоминания

**Ввод:**
```
сегодня в 11:10 купить молоко
```

**Ответ бота:**
```
Установленное напоминание: купить молоко
Время срабатывания: 2024-01-15 11:10
```

### Повторяющиеся напоминания

**Ввод:**
```
ежедневно в 8:30 пробежка
```

**Ответ бота:**
```
Установленное напоминание: пробежка
Время срабатывания: 2024-01-16 08:30 (повторяется ежедневно)
```

### Просмотр списка напоминаний

**Команда:**
```
/list
```

**Ответ бота:**
```
- купить молоко
  Время срабатывания: 2024-01-15 11:10

- пробежка
  Время срабатывания: 2024-01-16 08:30 (повторяется ежедневно)

- планерка
  Время срабатывания: 2024-01-22 10:00 (повторяется еженедельно)
```

## Поддерживаемые форматы времени

Бот понимает различные форматы времени на русском языке:

- `сегодня в 15:30`
- `завтра в 9:00`
- `послезавтра в 14:00`
- `в понедельник в 10:00`
- `в следующую пятницу в 18:00`
- `через час`
- `через 2 часа`
- `через 30 минут`
- `14:00 следующего вторника`
- `1 января в 12:00`

## Архитектура

Проект следует принципам чистой архитектуры:

```
cmd/bot/main.go          # Точка входа, инициализация бота и базы данных
internal/handler/        # Обработка сообщений и команд
internal/models/         # Модели данных
internal/storage/        # Инициализация базы данных
```

### Основные компоненты

- **main.go**: Содержит основной цикл обработки сообщений и фоновую проверку напоминаний каждую минуту
- **handler.go**: Парсинг сообщений, определение типа повтора и создание напоминаний
- **storage.go**: Инициализация SQLite базы данных и создание таблиц
- **models/reminder.go**: Структура данных для напоминаний

### База данных

SQLite таблица `reminders`:
```sql
CREATE TABLE reminders (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    chat_id INTEGER,
    text TEXT,
    datetime DATETIME,
    repeat_type TEXT DEFAULT 'none'
);
```

### Типы повторов

- `none` - разовое напоминание (удаляется после срабатывания)
- `daily` - повторяется каждый день
- `weekly` - повторяется каждую неделю
- `monthly` - повторяется каждый месяц
- `yearly` - повторяется каждый год

## Переменные окружения

- `BOT_TOKEN` - токен Telegram бота (обязательно)
- `ENV` - режим запуска (`dev` для разработки, иначе продакшн)

В режиме разработки:
- Включены отладочные сообщения
- База данных создается как `reminders.db` в текущей директории

В продакшн режиме:
- Отладочные сообщения отключены
- База данных создается в `/app/data/reminders.db`

## Разработка

### Сборка
```bash
go build -o reminder ./cmd/bot
```

### Тестирование
```bash
go test ./...
```

### Форматирование кода
```bash
go fmt ./...
```

### Проверка зависимостей
```bash
go mod tidy
```

## Зависимости

- `github.com/go-telegram-bot-api/telegram-bot-api/v5` - API для работы с Telegram
- `github.com/mattn/go-sqlite3` - SQLite драйвер
- `github.com/olebedev/when` - Парсинг естественного языка для времени

## Лицензия

MIT License